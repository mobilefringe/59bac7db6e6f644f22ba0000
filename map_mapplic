<link href="//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/text/css/1510935230000/mapplic.css" rel="stylesheet">
<link href="//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/text/css/1485967426000/map.css" rel="stylesheet">
<script type="text/javascript" src="//mallmaverick.cdn.speedyrails.net/javascripts/mapsvg/jquery.mousewheel.js"></script>
<script src="//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/text/javascript/1487363250000/mapplic.js"></script>
<script src="//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/text/javascript/1484859750000/hammer.min.js"></script>
    
<div id="mapplic" class="mapplic"></div>

<script>
    $(document).ready(function(e){
        init(e);
        
        loadMallDataCached(renderPage);
    });
    
    function renderPage(){
        var stores = getStoresList();
        console.log(stores);
        var mall_json = {};
        mall_json.mapwidth = "1000";
        mall_json.mapheight = "600";
        mall_json.categories=[]; 
        var store_cats = getStoreCategories();
        console.log(store_cats);
        $.each(store_cats, function(key,val){
            var temp_val = {};
            temp_val.id = val.id;
            temp_val.title= val.name;
            temp_val.color= "#b7a6bd";
            temp_val.show="true";
            mall_json.categories.push(temp_val);
        });
        mall_json.levels=[]; 
        // need to add the following for each floor we want to configure.
        var floor_1 ={};
        floor_1.id = "first-floor";
        floor_1.title = "Floor 1";
        floor_1.map = "//www.mallmaverick.com/system/site_images/photos/000/034/436/original/Northpark_-_Map_-_Floor_1_-_Mapplic_Test_1.svg";
        floor_1.minimap = "//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/image/jpeg/1510940237000/Northpark_-_Map_-_Floor_1_-_Mapplic_Test_1.jpg";
        floor_1.locations = [];
        $.each(stores, function(key,val){
            //for testing limiting the store numbers to this
            if(key < 20) {
                var temp_val = {};
                temp_val.id = val.id;
                temp_val.title= val.name;
                temp_val.about = val.description;
                temp_val.category = val.categories[1];
                temp_val.thumbnail = "";
                temp_val.link = "/stores/"+val.slug;
                if(val.store_front_url_abs.indexOf("missing") == -1){
                    temp_val.thumbnail=val.store_front_url_abs;
                }
                
                temp_val.x = val.x_coordinate;
                temp_val.y = val.y_coordinate;
                floor_1.locations.push(temp_val);
            }
        });
        mall_json.levels.push(floor_1);
        console.log(mall_json);
        var map = $('#mapplic').mapplic({
        	source: mall_json,
        	height: 600,
        	mapfill:true,
        	minimap: true,
        	sidebar: true,
        	hovertip: true,
        	developer: true,
        	maxscale: 5
        });
        map.on('mapready', function(e, self) {
        	console.log('Map is ready!')
        	// self grants direct access to the map object
        	// The map will be focused on the washing machine by default
        // 	self.moveTo(0.67, 0.62, 3, 0);
        
            var location = self.getLocationData('stores_x5F_1_x5F_36');
            console.log(self);
            console.log("location",location);
            console.log("stores_x5F_1_x5F_36", $("#stores_x5F_1_x5F_36"));
        });
        map.on('mapready', function(e, self) {
            var location = self.getLocationData('pos');
    		location.lat = pos.coords.latitude;
    		location.lng = pos.coords.longitude;
    		self.updateLocation('pos');
    	});
        	
        show_content();
    }
</script>
<!--//www.mallmaverick.com/system/site_images/photos/000/034/436/original/Northpark_-_Map_-_Floor_1_-_Mapplic_Test_1.svg?1510930761-->
<!--//codecloud.cdn.speedyrails.net/sites/59bac7db6e6f644f22ba0000/application/json/1472253662000/mall.json-->