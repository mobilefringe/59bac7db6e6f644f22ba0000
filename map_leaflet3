<style>
        /*body {*/
        /*    margin: 0px;*/
        /*}*/
        /*#map {*/
        /*    position: relative;*/
        /*    height: 100%;*/
        /*    width: 100%;*/
        /*    background-color: #333;*/
        /*}*/
         html, body, #map { width:90%; height:400px; margin:auto; padding:0; }
    svg {
        width:900px;
        height:400px;
    }
    </style>
<div id="map">
    </div>
    <div id="tooltip" style="width:230px; height:100px;">
     </div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" rel="stylesheet">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://www.sumbera.com/gist/js/leaflet/svg/scaled/leaflet.js"></script>
<script src="../l.svgscaleoverlay.js" type="text/javascript"></script>
 <script src="http://www.sumbera.com/gist/data.js" charset="utf-8"></script>
    
     <script>
        
      
            var lmap = new  L.map('map').setView([50.00, 14.44], 9)
                        .addLayer(L.tileLayer("http://{s}.sm.mapstack.stamen.com/(toner-lite,$fff[difference],$fff[@23],$fff[hsl-saturation@20])/{z}/{x}/{y}.png"));

            var circles;

            var svgOverlay = L.SvgScaleOverlay({svg_url:"//mallmaverick.cdn.speedyrails.net/system/properties/svgmaps/000/000/028/original/Londonderry_DB_4.svg?1497642416"});
            var radius = 3;
    
            console.log("this is one");
            svgUrl = "//mallmaverick.cdn.speedyrails.net/system/properties/svgmaps/000/000/028/original/Londonderry_DB_4.svg?1497642416"
            //------------------------------------------------------------
            svgOverlay.onInitData = function (svgUrl) {
                if (!circles) {
                    var g = d3.select(this._g);
                    circles = g.selectAll("circle")
                                    .data(data)
                                    .enter().append('circle');
                    // -- opacity based on grouping optimization in point data
                    circles.style("fill-opacity", 0.8);
                    circles.style("fill", "rgba(255,116,116, 0.5)")
                    console.log("in onInitData 1");
                }
                
                
                circles.each(function (d) {
                    var elem = d3.select(this);
                    var point = lmap.project(L.latLng(new L.LatLng(d[0], d[1])))._subtract(lmap.getPixelOrigin());
                    //var point = lmap.latLngToLayerPoint(new L.LatLng(d.geometry.coordinates[1], d.geometry.coordinates[0]));
                    elem.attr('cx', point.x)
                    elem.attr('cy', point.y)
                    elem.attr('r', radius)
                })
                console.log("in onInitData 2");
            };
            console.log("this is second");
            svgOverlay.onScaleChange = function (scaleDiff) {
                if (scaleDiff > 0.5) {
                    var newRadius = radius * 1 / scaleDiff;

                    var currentRadius = d3.select('circle').attr("r");
                    if (currentRadius != newRadius) {
                        d3.selectAll("circle").attr('r', newRadius);
                    }
                }

            };
            svgOverlay.initSvgContainer = function (){
                d3.xml(svg_url).mimeType("image/svg+xml").get(function(error, svgImg) {
            if (error) throw error;
              svgImg_doc = svgImg.documentElement;
            //   console.log(svgImg.documentElement);
            //   console.log(svgImg);
            
            //  document.appendChild(svgImg.documentElement);
            this._map =  this.svgOverlay._map;
            this.svgOverlay._map.getPanes().overlayPane.appendChild(svgImg.documentElement);
            //   this._svg.addClass('leaflet-zoom-hide');
            overlayClass=this.svgOverlay._map.getPanes().overlayPane.className.replace(/ /g, '.');
            // overlayClass
              this._svg =  $('.'+ overlayClass +' svg')[0];
              this._g =  $('.'+ overlayClass +' svg g');
              
               console.log(this._svg);
               
                });
            }

            // console.log();
            lmap.addLayer(svgOverlay);
            console.log("this is 5");
            /***********************/
        $('.custom_backdrop').remove();
        $('.yield').fadeIn();
            
            

    </script>